Taken from paste and ported to python3
